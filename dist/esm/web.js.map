{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from '@capacitor/core';\n\nimport type { CactusCapPlugin } from './definitions';\n\nexport class CactusCapWeb extends WebPlugin implements CactusCapPlugin {\n  private isModelInitialized = false;\n\n  async echo(options: { value: string }): Promise<{ value: string }> {\n    console.log('ECHO', options);\n    return options;\n  }\n\n  async downloadModel(options: { modelSlug: string }): Promise<{ success: boolean; modelPath: string; modelName: string; modelSlug: string; error?: string }> {\n    console.log('Web: Downloading model:', options.modelSlug);\n    return { \n      success: true, \n      modelPath: `/mock/path/to/${options.modelSlug}`,\n      modelName: options.modelSlug,\n      modelSlug: options.modelSlug\n    };\n  }\n\n  async getAvailableModels(): Promise<{ \n    success: boolean; \n    models?: Array<{\n      slug: string;\n      path: string;\n    }>;\n    error?: string;\n  }> {\n    console.log('Web: Getting available models');\n    return { \n      success: true,\n      models: [\n        {\n          slug: 'qwen3-0.6',\n          path: '/mock/path/to/qwen3-0.6'\n        },\n        {\n          slug: 'lfm2-vl-450m',\n          path: '/mock/path/to/lfm2-vl-450m'\n        }\n      ]\n    };\n  }\n\n  async initializeModel(options: {\n    modelSlug?: string;\n    modelPath?: string;\n    contextSize: number;\n  }): Promise<{\n    success: boolean;\n    error?: string;\n  }> {\n    this.isModelInitialized = true;\n    console.log('CactusPlugin.initializeModel() called with:', options);\n    return { success: true };\n  }\n\n  async loadModel(options: {\n    modelSlug: string;\n    contextSize?: number;\n  }): Promise<{\n    success: boolean;\n    error?: string;\n  }> {\n    this.isModelInitialized = true;\n    const { modelSlug, contextSize = 2048 } = options;\n    console.log('CactusPlugin.loadModel() called with:', { modelSlug, contextSize });\n    return { success: true };\n  }\n\n  async loadLocalModel(options: {\n    modelPath: string;\n    modelSlug?: string;\n    contextSize?: number;\n  }): Promise<{\n    success: boolean;\n    error?: string;\n  }> {\n    this.isModelInitialized = true;\n    const { modelPath, modelSlug, contextSize = 2048 } = options;\n    console.log('CactusPlugin.loadLocalModel() called with:', { modelPath, modelSlug, contextSize });\n    return { success: true };\n  }\n\n  async generateCompletion(options: {\n    messages: Array<{\n      role: 'system' | 'user' | 'assistant' | 'function';\n      content: string;\n      name?: string;\n      tool_call_id?: string;\n    }>;\n    temperature?: number;\n    maxTokens?: number;\n    topP?: number;\n    topK?: number;\n    stopSequences?: string[];\n    tools?: Array<{\n      type: 'function';\n      function: {\n        name: string;\n        description: string;\n        parameters: any;\n      };\n    }>;\n  }): Promise<{\n    success: boolean;\n    response?: string;\n    timeToFirstTokenMs?: number;\n    totalTimeMs?: number;\n    tokensPerSecond?: number;\n    prefillTokens?: number;\n    decodeTokens?: number;\n    totalTokens?: number;\n    toolCalls?: Array<{\n      name: string;\n      arguments: any;\n    }>;\n    error?: string;\n  }> {\n    if (!this.isModelInitialized) {\n      return { success: false, error: 'No model initialized' };\n    }\n    \n    console.log('Web: Generating completion with messages:', options.messages);\n    \n    // Check if we should return a tool call\n    if (options.tools && options.tools.length > 0) {\n      return {\n        success: true,\n        response: '',\n        toolCalls: [\n          {\n            name: options.tools[0].function.name,\n            arguments: JSON.parse(JSON.stringify({ location: 'New York' }))\n          }\n        ],\n        timeToFirstTokenMs: 100,\n        totalTimeMs: 200,\n        tokensPerSecond: 50\n      };\n    }\n    \n    return {\n      success: true,\n      response: `Mock response for: ${options.messages[options.messages.length - 1].content}`,\n      timeToFirstTokenMs: 100,\n      totalTimeMs: 500,\n      tokensPerSecond: 50,\n      prefillTokens: 10,\n      decodeTokens: 20,\n      totalTokens: 30\n    };\n  }\n\n  async generateStreamingCompletion(options: {\n    messages: Array<{\n      role: 'system' | 'user' | 'assistant' | 'function';\n      content: string;\n      name?: string;\n      tool_call_id?: string;\n    }>;\n    temperature?: number;\n    maxTokens?: number;\n    topP?: number;\n    topK?: number;\n    stopSequences?: string[];\n    tools?: Array<{\n      type: 'function';\n      function: {\n        name: string;\n        description: string;\n        parameters: any;\n      };\n    }>;\n  }): Promise<{\n    success: boolean;\n    error?: string;\n  }> {\n    if (!this.isModelInitialized) {\n      return { success: false, error: 'No model initialized' };\n    }\n    \n    console.log('Web: Generating streaming completion with messages:', options.messages);\n    \n    // For web mock, we'll just simulate a stream by emitting events\n    setTimeout(() => {\n      this.notifyListeners('cactusStreamingResponse', {\n        type: 'start',\n        data: {}\n      });\n    }, 100);\n    \n    // Simulate streaming tokens\n    const tokens = ['Mock', ' stream', ' response', ' for:', ' ', options.messages[options.messages.length - 1].content];\n    let fullResponse = '';\n    tokens.forEach((token, index) => {\n      fullResponse += token;\n      setTimeout(() => {\n        this.notifyListeners('cactusStreamingResponse', {\n          type: 'token',\n          data: {\n            token,\n            completion: fullResponse\n          }\n        });\n      }, 200 + (index * 100));\n    });\n    \n    // Simulate completion\n    setTimeout(() => {\n      this.notifyListeners('cactusStreamingResponse', {\n        type: 'done',\n        data: {\n          completion: fullResponse,\n          usage: {\n            prefillTokens: 10,\n            decodeTokens: tokens.length,\n            totalTokens: 10 + tokens.length\n          },\n          generationMetrics: {\n            timeToFirstTokenMs: 100,\n            totalTimeMs: 500,\n            tokensPerSecond: 50\n          }\n        }\n      });\n    }, 200 + (tokens.length * 100));\n    \n    return { success: true };\n  }\n\n  async transcribeAudio(options: {\n    audioPath: string;\n    prompt?: string;\n    language?: string;\n    temperature?: number;\n    maxTokens?: number;\n  }): Promise<{\n    success: boolean;\n    transcription?: string;\n    error?: string;\n  }> {\n    console.log('Web: Transcribing audio from path:', options.audioPath);\n    return {\n      success: true,\n      transcription: 'Mock transcription of the audio file (mock)'\n    };\n  }\n\n  async unloadModel(): Promise<{ success: boolean; error?: string }> {\n    this.isModelInitialized = false;\n    console.log('Web: Model unloaded');\n    return { success: true };\n  }\n\n  async getTextEmbeddings(options: {\n    text: string;\n  }): Promise<{\n    success: boolean;\n    embeddings?: number[];\n    error?: string;\n  }> {\n    console.log('Web: Getting text embeddings for:', options.text);\n    if (!this.isModelInitialized) {\n      return { success: false, error: 'No model initialized' };\n    }\n    // Generate mock embeddings with 1024 dimensions\n    const embeddings = Array.from({ length: 1024 }, () => Math.random() * 2 - 1);\n    return {\n      success: true,\n      embeddings\n    };\n  }\n\n  async getImageEmbeddings(options: {\n    imagePath: string;\n  }): Promise<{\n    success: boolean;\n    embeddings?: number[];\n    error?: string;\n  }> {\n    console.log('Web: Getting image embeddings for:', options.imagePath);\n    if (!this.isModelInitialized) {\n      return { success: false, error: 'No model initialized' };\n    }\n    // Generate mock embeddings with 1024 dimensions\n    const embeddings = Array.from({ length: 1024 }, () => Math.random() * 2 - 1);\n    return {\n      success: true,\n      embeddings\n    };\n  }\n\n  async getAudioEmbeddings(options: {\n    audioPath: string;\n  }): Promise<{\n    success: boolean;\n    embeddings?: number[];\n    error?: string;\n  }> {\n    console.log('Web: Getting audio embeddings for:', options.audioPath);\n    if (!this.isModelInitialized) {\n      return { success: false, error: 'No model initialized' };\n    }\n    // Generate mock embeddings with 1024 dimensions\n    const embeddings = Array.from({ length: 1024 }, () => Math.random() * 2 - 1);\n    return {\n      success: true,\n      embeddings\n    };\n  }\n\n  // Download Management Methods\n  async pauseDownload(options: { modelSlug: string }): Promise<void> {\n    console.log('Web: Pausing download for model:', options.modelSlug);\n    // Mock implementation - no-op for web\n  }\n\n  async resumeDownload(options: { modelSlug: string }): Promise<void> {\n    console.log('Web: Resuming download for model:', options.modelSlug);\n    // Mock implementation - no-op for web\n  }\n\n  async cancelDownload(options: { modelSlug: string }): Promise<void> {\n    console.log('Web: Cancelling download for model:', options.modelSlug);\n    // Mock implementation - no-op for web\n  }\n\n  async getDownloadProgress(options: {\n    modelSlug: string;\n  }): Promise<{\n    success: boolean;\n    stage?: 'downloading' | 'unzipping' | 'finished';\n    progress?: number;\n    modelPath?: string;\n    error?: string;\n  }> {\n    console.log('Web: Getting download progress for model:', options.modelSlug);\n    return {\n      success: true,\n      stage: 'finished',\n      progress: 1.0,\n      modelPath: `/mock/path/to/${options.modelSlug}`\n    };\n  }\n}\n"]}